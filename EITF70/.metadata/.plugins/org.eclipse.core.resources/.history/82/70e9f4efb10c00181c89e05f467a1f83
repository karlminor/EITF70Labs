/*.global readSwitches_writeLed_Assembly
.text
.ent readSwitches_writeLed_Assembly

readSwitches_writeLed_Assembly:
	lwi r11,r0, 0x40020000
	swi r11,r0, 0x40010000
	rtsd r15,8
	nop
.end readSwitches_writeLed_Assembly
*/

.global function
.text
.ent function
function:
			addi r1,r1,-4
			swi r15,r1,0
			lwi r5,r0, 0x40020000
			brlid r15, number_of_ones
			nop
			add r5,r3,r0
			brlid r15,translateN
			nop
			swi r3,r0,0x40010000
			lwi r15,r1,0
			addi r1,r1,4
			rtsd r15, 8
			nop
.end function


.global number_of_ones
.text
.ent number_of_ones
number_of_ones:
			add r3,r0,r0
while: 		beqid r5, result
			nop
			andi r4,r5,1
			add r3,r3,r4
			sra r5,r5
			brid while
			nop
result: 	rtsd r15, 8
			nop
.end number_of_ones

.global translateN
.text
.ent translateN
translateN:
			addi r3,r0,1
again: 		beqid r5, done
			nop
			addi r5,r5,-1
			add r3,r3,r3
			brid again
			nop
done: 		addi r3,r3,-1
			rtsd r15, 8
			nop
.end translateN


.global process_switches
.text
.ent process_switches
process_switches:
			addi r1,r1,-4
			sw r15,r1,r0
			lwi r6,r0, 0x40020000
			add r5,r0,r0
			addi r7,r0,8
			addi r10,r0,1
shift:	 	beqi r7, arg_ready
			nop
			andi r9, r6,1
			add r5,r5,r5
			add r5,r5,r9
			sra r6,r6
			rsub r7,r10,r7
			brid shift
			nop
arg_ready: 	brlid r15, number_of_ones
			nop
			add r7,r3,r0
			add r5,r6,r0
			brlid r15, first_position_of_one
			nop
			add r6,r3,r0
			add r5,r7,r0
			brlid r15, display_value_at_index
			nop
			lw r15,r1,r0
			addi r1,r1,4
			rtsd r15, 8
			nop
.end process_switches

.global first_position_of_one
.text
.ent first_position_of_one
first_position_of_one:
			add r3,r0,r0
			beqi r5, found
			nop
next: 		andi r4,r5,1
			bneid r4, found
			nop
			addi r3,r3,1
			sra r5,r5
			brid next
			nop
found: 		rtsd r15,8
			nop
.end first_position_of_one

.global display_value_at_index
.text
.ent display_value_at_index
display_value_at_index:
			add r7,r5,r5
			add r7,r7,r7
			add r8,r6,r6
			add r8,r8,r8
			addi r9,r0,7
			addi r10,r0,0x44A00000
			addi r11,r0,1
reset_display: add r12, r9,r9
			add r12,r12,r12
			sw r0,r10,r12
			rsub r9,r11,r9
			bgeid r9, reset_display
			nop
			lwi r9,r7,display_codes
			sw r9, r10, r8
			rtsd r15, 8
			nop
.end display_value_at_index

.global switches_battle
.text
.ent switches_battle
switches_battle:
			lwi r6,r0, 0x40020000
			add r5,r0,r0
			add r8,r0,r0
			addi r7,r0,8
			addi r10,r0,1
shiftright:	beqi r7, firstshift
			nop
			andi r9, r6,1
			add r5,r5,r9
			sra r6,r6
			rsub r7,r10,r7
			brid shiftright
			nop
firstshift: addi r7,r0,8
shiftleft: 	beqi r7, secondshift
			nop
			andi r9, r6,1
			add r8,r8,r9
			sra r6,r6
			rsub r7,r10,r7
			brid shiftleft
			nop
secondshift:cmp r18,r5,r8
			bgei r18, leftwon
			swi r0,r0,0x40010000
			bri finish
leftwon:	addi r11,r0,0xffff
			swi r11,r0,0x40010000
finish:		rtsd r15,8
			nop
.end switches_battle


.global switches_matcher
.text
.ent switches_matcher
switches_matcher:
			addi r1,r1,-4
			sw r15,r1,r0
			lwi r23,r0, 0x40020000
			add r22,r0,r0
			add r24,r0,r0
			addi r20,r0,8
			addi r21,r0,1
right:		beqi r20, compare
			nop
			andi r9,r23,1
			add r22,r22,r9
			sra r23,r23
			addk r22,r22,r22
			rsub r20,r21,r20
			brid right
			nop
compare:	sra r22,r22
			xor r24,r22,r23
			xori r24,r24,255
initshift:	addi r20,r0,8
			add r23,r0,r0
secshift:	beqi r20, finished
			andi r22,r24,1
			add r5,r0,r22
			add r6,r0,r23
			brlid r15, display_value_at_index_two
			nop
			sra r24,r24
			rsub r20,r21,r20
			add r23,r23,r21
			brid secshift
			nop
finished:	lw r15,r1,r0
			rtsd r15,8
			nop
.end switches_matcher

.global display_value_at_index_two
.text
.ent display_value_at_index_two
display_value_at_index_two:
			add r7,r5,r5
			add r7,r7,r7
			add r8,r6,r6
			add r8,r8,r8
			addi r10,r0,0x44A00000
			lwi r9,r7,display_codes
			sw r9, r10, r8
			rtsd r15, 8
			nop
.end display_value_at_index_two

